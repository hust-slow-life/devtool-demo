# DevTools 技术设计方案

## 1. 架构概述

### 1.1 技术选型

| 模块 | 选型 | 说明 |
|------|------|------|
| 前端框架 | 原生 HTML/CSS/JS | 无构建工具，直接运行 |
| 加密库 | Web Crypto API + crypto-js | SHA 用原生 API，MD5/SHA3 用库 |
| 文件处理 | File API + FileReader | 支持拖拽上传 |
| 样式方案 | CSS 变量 + 原生 CSS | 支持主题切换 |

### 1.2 设计原则
- **无依赖**: 除 crypto-js 外不使用其他第三方库
- **无构建**: 无需 webpack/vite 等构建工具
- **模块化**: 组件可复用
- **渐进增强**: 优先保证核心功能

## 2. 目录结构

```
devtools/
├── index.html                    # 首页
├── css/
│   └── style.css                 # 全局样式 + 主题变量
├── js/
│   ├── common.js                 # 全局功能
│   ├── hex-view.js               # HEX 视图组件
│   ├── code-tabs.js              # 代码示例组件
│   └── file-upload.js            # 文件上传组件
├── tools/
│   ├── unix-timestamp.html
│   ├── base64.html
│   ├── url-encode.html
│   ├── hash.html
│   └── uuid.html
└── libs/
    └── crypto-js.min.js
```

## 3. 核心模块设计

### 3.1 主题系统

使用 CSS 变量实现主题切换：

```css
:root {
  --color-bg: #ffffff;
  --color-text: #1a1a2e;
  /* ... */
}

[data-theme="dark"] {
  --color-bg: #0f172a;
  --color-text: #f1f5f9;
  /* ... */
}
```

JavaScript 控制：
```javascript
// 读取系统偏好
const prefersDark = window.matchMedia('(prefers-color-scheme: dark)').matches;

// 切换主题
document.documentElement.setAttribute('data-theme', theme);

// 持久化
localStorage.setItem('devtools-theme', theme);
```

### 3.2 HexView 组件

显示二进制数据的十六进制视图：

```
Offset      Hex                                        ASCII
00000000    48 65 6C 6C 6F 2C 20 57  6F 72 6C 64 21   Hello, World!
```

核心功能：
- 每行 16 字节
- 支持悬停高亮
- 显示文件大小统计

API：
```javascript
const hexView = new HexView('#container', {
  bytesPerRow: 16,
  maxRows: 100
});
hexView.setData(uint8Array);
```

### 3.3 CodeTabs 组件

多语言代码示例切换：

```javascript
const codeTabs = new CodeTabs('#container');
codeTabs.setExamples([
  { lang: 'javascript', label: 'JavaScript', code: '...' },
  { lang: 'python', label: 'Python', code: '...' }
]);
```

功能：
- Tab 切换
- 一键复制
- 语法高亮（可选）

### 3.4 FileUpload 组件

拖拽上传文件：

```javascript
const upload = new FileUpload('#container', {
  maxSize: 50 * 1024 * 1024, // 50MB
  onFile: (file, data) => { /* ... */ },
  onError: (err) => { /* ... */ }
});
```

功能：
- 拖拽上传
- 点击选择
- 大小验证
- 读取为 ArrayBuffer

## 4. 加密模块设计

### 4.1 算法支持

| 算法 | 实现方式 | 说明 |
|------|----------|------|
| SHA-1 | Web Crypto API | `crypto.subtle.digest('SHA-1', data)` |
| SHA-256 | Web Crypto API | `crypto.subtle.digest('SHA-256', data)` |
| SHA-384 | Web Crypto API | `crypto.subtle.digest('SHA-384', data)` |
| SHA-512 | Web Crypto API | `crypto.subtle.digest('SHA-512', data)` |
| MD5 | crypto-js | `CryptoJS.MD5(data)` |
| SHA3-256 | crypto-js | `CryptoJS.SHA3(data, {outputLength: 256})` |
| SHA3-512 | crypto-js | `CryptoJS.SHA3(data, {outputLength: 512})` |

### 4.2 UUID 生成

**v4 (随机)**:
```javascript
const bytes = crypto.getRandomValues(new Uint8Array(16));
bytes[6] = (bytes[6] & 0x0f) | 0x40; // version 4
bytes[8] = (bytes[8] & 0x3f) | 0x80; // variant 10xx
```

**v5 (SHA-1)**:
```javascript
const combined = concat(namespaceBytes, nameBytes);
const hash = await crypto.subtle.digest('SHA-1', combined);
const bytes = new Uint8Array(hash).slice(0, 16);
bytes[6] = (bytes[6] & 0x0f) | 0x50; // version 5
bytes[8] = (bytes[8] & 0x3f) | 0x80; // variant 10xx
```

## 5. 性能优化

### 5.1 大文件处理
- 限制最大 50MB
- 使用 FileReader 异步读取
- Hash 计算使用 Web Crypto API（硬件加速）

### 5.2 内存管理
- 使用 TypedArray 处理二进制数据
- 及时释放不再使用的 ArrayBuffer
- HexView 限制最大显示行数

### 5.3 渲染优化
- 使用 CSS 变量实现主题切换（避免重绘）
- 延迟加载非关键资源
- 减少 DOM 操作

## 6. 安全考虑

### 6.1 数据安全
- 所有计算在浏览器本地完成
- 不发送任何数据到服务器
- 不使用第三方追踪脚本

### 6.2 XSS 防护
- 使用 `textContent` 而非 `innerHTML` 显示用户输入
- 对 HEX View 中的特殊字符进行转义
- 不执行用户输入的代码

### 6.3 CSP 建议
```html
<meta http-equiv="Content-Security-Policy"
      content="default-src 'self'; script-src 'self' 'unsafe-inline';">
```

## 7. 浏览器兼容性

### 7.1 必需 API
- `crypto.subtle` (Web Crypto API)
- `crypto.getRandomValues`
- `TextEncoder` / `TextDecoder`
- `FileReader`
- CSS 变量

### 7.2 兼容范围
- Chrome 60+
- Firefox 55+
- Safari 11+
- Edge 79+

## 8. 扩展性

### 8.1 添加新工具
1. 创建 `tools/new-tool.html`
2. 在 `index.html` 添加卡片
3. 更新导航栏

### 8.2 添加新算法
1. 在 `common.js` 的 Hash 模块添加
2. 在 hash.html 的下拉菜单添加选项
3. 更新代码示例

### 8.3 添加新语言示例
1. 在 `code-tabs.js` 的 templates 添加
2. 在相应页面的 setExamples 调用中添加
