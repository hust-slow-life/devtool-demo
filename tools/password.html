<!DOCTYPE html>
<html lang="zh-CN">
<head>
  <meta charset="UTF-8">
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <meta name="description" content="随机密码生成器 - 生成安全的随机密码，支持自定义长度和字符集">
  <title>密码生成器 - DevTools</title>
  <link rel="stylesheet" href="../css/style.css">
</head>
<body>
  <div class="page-wrapper">
    <!-- Header -->
    <header class="header">
      <div class="container">
        <a href="../index.html" class="logo">
          <span class="logo-icon">&#128736;</span>
          <span>DevTools</span>
        </a>
        <nav class="nav">
          <a href="../index.html" class="nav-link">首页</a>
          <a href="unix-timestamp.html" class="nav-link">时间戳</a>
          <a href="base64.html" class="nav-link">Base64</a>
          <a href="url-encode.html" class="nav-link">URL编码</a>
          <a href="hash.html" class="nav-link">Hash</a>
          <a href="uuid.html" class="nav-link">UUID</a>
          <a href="password.html" class="nav-link active">密码</a>
          <button class="theme-toggle" aria-label="切换主题">&#9790;</button>
        </nav>
      </div>
    </header>

    <!-- Main Content -->
    <main>
      <div class="container">
        <!-- Tool Header -->
        <div class="tool-header">
          <h1>&#128272; 随机密码生成器</h1>
          <p>使用加密安全的随机数生成器创建强密码</p>
        </div>

        <!-- Password Generator -->
        <section class="tool-section">
          <h2>生成密码</h2>

          <div class="form-inline mb-md">
            <div class="form-group">
              <label class="form-label" for="passwordLength">密码长度</label>
              <input type="number" id="passwordLength" class="form-input" value="16" min="4" max="128" style="width: 100px;">
            </div>
            <div class="form-group">
              <label class="form-label" for="passwordCount">生成数量</label>
              <input type="number" id="passwordCount" class="form-input" value="1" min="1" max="100" style="width: 100px;">
            </div>
          </div>

          <div class="password-options">
            <div class="password-option">
              <input type="checkbox" id="optUppercase" checked>
              <label for="optUppercase">大写字母 (A-Z)</label>
            </div>
            <div class="password-option">
              <input type="checkbox" id="optLowercase" checked>
              <label for="optLowercase">小写字母 (a-z)</label>
            </div>
            <div class="password-option">
              <input type="checkbox" id="optNumbers" checked>
              <label for="optNumbers">数字 (0-9)</label>
            </div>
            <div class="password-option">
              <input type="checkbox" id="optSymbols" checked>
              <label for="optSymbols">特殊字符 (!@#$%...)</label>
            </div>
            <div class="password-option">
              <input type="checkbox" id="optExcludeSimilar">
              <label for="optExcludeSimilar">排除相似字符 (0O1lI)</label>
            </div>
          </div>

          <div class="btn-group mb-md">
            <button class="btn btn-primary" id="generatePassword">生成密码</button>
          </div>

          <div class="password-strength" id="strengthIndicator">
            <span>强度:</span>
            <div class="password-strength-bar">
              <div class="password-strength-fill" id="strengthFill"></div>
            </div>
            <span class="password-strength-text" id="strengthText">-</span>
          </div>

          <div class="form-group mt-md">
            <label class="form-label">生成的密码</label>
            <div id="passwordResult" class="password-list">
              <div class="info-box info">点击"生成密码"按钮生成随机密码</div>
            </div>
          </div>

          <div class="btn-group">
            <button class="btn btn-sm btn-secondary" id="copyAllPasswords">&#128203; 复制全部</button>
          </div>
        </section>

        <!-- Info -->
        <section class="tool-section">
          <h2>关于密码安全</h2>
          <div class="info-box info mb-md">
            <strong>安全提示：</strong>本工具使用 Web Crypto API 生成加密安全的随机数，所有计算在浏览器本地完成，密码不会上传至服务器。
          </div>

          <h3 class="mb-md">密码强度建议</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>强度</th>
                  <th>条件</th>
                  <th>建议用途</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td><span style="color: var(--color-error);">弱</span></td>
                  <td>长度 &lt; 8 或字符集 &lt; 2</td>
                  <td>不建议使用</td>
                </tr>
                <tr>
                  <td><span style="color: var(--color-warning);">中</span></td>
                  <td>长度 8-12 且字符集 &ge; 3</td>
                  <td>普通账户</td>
                </tr>
                <tr>
                  <td><span style="color: var(--color-success);">强</span></td>
                  <td>长度 &gt; 12 且字符集 = 4</td>
                  <td>重要账户、管理员</td>
                </tr>
              </tbody>
            </table>
          </div>

          <h3 class="mt-lg mb-md">字符集说明</h3>
          <div class="table-container">
            <table>
              <thead>
                <tr>
                  <th>类型</th>
                  <th>字符</th>
                  <th>数量</th>
                </tr>
              </thead>
              <tbody>
                <tr>
                  <td>大写字母</td>
                  <td style="font-family: monospace;">A-Z</td>
                  <td>26</td>
                </tr>
                <tr>
                  <td>小写字母</td>
                  <td style="font-family: monospace;">a-z</td>
                  <td>26</td>
                </tr>
                <tr>
                  <td>数字</td>
                  <td style="font-family: monospace;">0-9</td>
                  <td>10</td>
                </tr>
                <tr>
                  <td>特殊字符</td>
                  <td style="font-family: monospace;">!@#$%^&*()_+-=[]{}|;:,.<>?</td>
                  <td>26</td>
                </tr>
              </tbody>
            </table>
          </div>
        </section>

        <!-- Code Examples -->
        <section class="tool-section">
          <h2>代码示例</h2>
          <div id="codeExamples"></div>
        </section>
      </div>
    </main>

    <!-- Footer -->
    <footer class="footer">
      <div class="container">
        <p class="footer-text">DevTools - 开发者工具集</p>
        <div class="footer-links">
          <a href="https://github.com" target="_blank">GitHub</a>
        </div>
      </div>
    </footer>
  </div>

  <script src="../js/common.js"></script>
  <script src="../js/code-tabs.js"></script>
  <script>
    (function() {
      'use strict';

      // Character sets
      const UPPERCASE = 'ABCDEFGHIJKLMNOPQRSTUVWXYZ';
      const LOWERCASE = 'abcdefghijklmnopqrstuvwxyz';
      const NUMBERS = '0123456789';
      const SYMBOLS = '!@#$%^&*()_+-=[]{}|;:,.<>?';
      const SIMILAR = '0O1lI';

      // Elements
      const passwordLength = document.getElementById('passwordLength');
      const passwordCount = document.getElementById('passwordCount');
      const optUppercase = document.getElementById('optUppercase');
      const optLowercase = document.getElementById('optLowercase');
      const optNumbers = document.getElementById('optNumbers');
      const optSymbols = document.getElementById('optSymbols');
      const optExcludeSimilar = document.getElementById('optExcludeSimilar');
      const generatePasswordBtn = document.getElementById('generatePassword');
      const passwordResult = document.getElementById('passwordResult');
      const copyAllPasswordsBtn = document.getElementById('copyAllPasswords');
      const strengthFill = document.getElementById('strengthFill');
      const strengthText = document.getElementById('strengthText');

      let generatedPasswords = [];

      // Generate a single password
      function generatePassword(length, options) {
        let chars = '';

        if (options.uppercase) chars += UPPERCASE;
        if (options.lowercase) chars += LOWERCASE;
        if (options.numbers) chars += NUMBERS;
        if (options.symbols) chars += SYMBOLS;

        if (options.excludeSimilar) {
          for (const char of SIMILAR) {
            chars = chars.replace(new RegExp(char, 'g'), '');
          }
        }

        if (chars.length === 0) {
          throw new Error('请至少选择一种字符类型');
        }

        const array = new Uint32Array(length);
        crypto.getRandomValues(array);

        let password = '';
        for (let i = 0; i < length; i++) {
          password += chars[array[i] % chars.length];
        }

        return password;
      }

      // Calculate password strength
      function calculateStrength(length, options) {
        let charsetCount = 0;
        if (options.uppercase) charsetCount++;
        if (options.lowercase) charsetCount++;
        if (options.numbers) charsetCount++;
        if (options.symbols) charsetCount++;

        if (length < 8 || charsetCount < 2) {
          return 'weak';
        } else if (length > 12 && charsetCount === 4) {
          return 'strong';
        } else if (length >= 8 && charsetCount >= 3) {
          return 'medium';
        } else {
          return 'weak';
        }
      }

      // Update strength indicator
      function updateStrengthIndicator(strength) {
        strengthFill.className = 'password-strength-fill ' + strength;
        strengthText.className = 'password-strength-text ' + strength;

        const labels = {
          weak: '弱',
          medium: '中',
          strong: '强'
        };
        strengthText.textContent = labels[strength];
      }

      // Render passwords
      function renderPasswords(passwords) {
        if (passwords.length === 0) {
          passwordResult.innerHTML = '<div class="info-box info">点击"生成密码"按钮生成随机密码</div>';
          return;
        }

        let html = '';
        passwords.forEach((pwd, index) => {
          html += `
            <div class="password-item">
              <span class="password-item-text">${escapeHtml(pwd)}</span>
              <button class="copy-btn" data-index="${index}">&#128203;</button>
            </div>
          `;
        });

        passwordResult.innerHTML = html;

        // Bind copy buttons
        passwordResult.querySelectorAll('.copy-btn').forEach(btn => {
          btn.addEventListener('click', function() {
            const index = parseInt(this.dataset.index, 10);
            DevTools.Clipboard.copy(passwords[index], this);
          });
        });
      }

      // Escape HTML
      function escapeHtml(str) {
        const div = document.createElement('div');
        div.textContent = str;
        return div.innerHTML;
      }

      // Generate passwords
      generatePasswordBtn.addEventListener('click', () => {
        const length = Math.min(Math.max(parseInt(passwordLength.value) || 16, 4), 128);
        const count = Math.min(Math.max(parseInt(passwordCount.value) || 1, 1), 100);

        const options = {
          uppercase: optUppercase.checked,
          lowercase: optLowercase.checked,
          numbers: optNumbers.checked,
          symbols: optSymbols.checked,
          excludeSimilar: optExcludeSimilar.checked
        };

        try {
          generatedPasswords = [];
          for (let i = 0; i < count; i++) {
            generatedPasswords.push(generatePassword(length, options));
          }

          renderPasswords(generatedPasswords);

          // Update strength indicator
          const strength = calculateStrength(length, options);
          updateStrengthIndicator(strength);

        } catch (e) {
          passwordResult.innerHTML = `<div class="info-box error">${e.message}</div>`;
          strengthFill.className = 'password-strength-fill';
          strengthText.textContent = '-';
        }
      });

      // Copy all passwords
      copyAllPasswordsBtn.addEventListener('click', function() {
        if (generatedPasswords.length === 0) return;
        DevTools.Clipboard.copy(generatedPasswords.join('\n'), this);
      });

      // Generate initial password
      generatePasswordBtn.click();

      // Code examples
      const codeTabs = new CodeTabs('#codeExamples');
      codeTabs.setExamples([
        { lang: 'bash', label: 'Bash', code: CodeTabs.templates.password.bash },
        { lang: 'javascript', label: 'JavaScript', code: CodeTabs.templates.password.javascript },
        { lang: 'python', label: 'Python', code: CodeTabs.templates.password.python },
        { lang: 'java', label: 'Java', code: CodeTabs.templates.password.java },
        { lang: 'swift', label: 'Swift', code: CodeTabs.templates.password.swift },
        { lang: 'go', label: 'Go', code: CodeTabs.templates.password.go }
      ]);
    })();
  </script>
</body>
</html>
